let uniqueid;$(function(){var e;let l,r=5678,s=[],d="2"===localStorage.getItem("_cells_customer_role"),c=decodeURIComponent(E("FolderName")),p=decodeURIComponent(E("FileName")),i=decodeURIComponent(E("Password")),t=o.CallbackURL,u=o.APIBasePath,a=decodeURIComponent(E("Uid")),m=o.AppUrl,n="https://www.googleapis.com/auth/drive.file",h=o.GoogleDriveConfigurations.GoogleDriveClientId,f,w=!1,g=!1;async function S(e){var t=e.receiver,e=e.type,a=l.datas,a=(delete a.history,delete a.search,delete a.images,delete a.shapes,{p:{sheetname:l.sheet.data.name,actrow:l.sheet.data.selector.ri,actcol:l.sheet.data.selector.ci,datas:l.getUpdateDatas()},uid:uniqueid,file:p,folderName:c,outputType:e,password:i,locale:o.Locale}),e=(e=>(e=pako.gzip(e),new Blob([e])))(JSON.stringify(a)),a=await fetch(u+"EditorApi/Download",{method:"POST",headers:{"Content-Type":"application/octet-stream","Content-Encoding":"gzip"},body:e});if(!a.ok)throw new Error("Failed to send email, please try again");e=await a.json(),a=new FormData,a.append("appName",o.AppName),a.append("email",t),a.append("url",e.DownloadFileLink),a.append("title","Aspose.Cells.Editor - "+e.FileName),t=await fetch("/cells/editor/Report/SendEmail",{method:"POST",crossDomain:!0,withCredentials:!0,body:a}),e=await t.json();if(t.ok)return e.message;throw new Error("Failed to send email,please try again")}function E(e){e=new RegExp(`(^|&)${e}=([^&]*)(&|$)`),e=window.location.search.substring(1).match(e);return null!=e?decodeURI(e[2]):""}function C(){window.parent&&window.parent.closeIframe?window.parent.closeIframe():window.location.href=t}function y(){w=!0}function A(e){return null==e||""===e||"null"===e||"undefined"===e}A(c)||A(p)?C():($("#file_name").text(p),e=u+"EditorApi/DetailStreamJsonWithUid",$.ajax({method:"POST",url:e,xhrFields:{withCredentials:!0},crossDomain:!0,data:JSON.stringify({file:p,folder:c,password:A(i)?"":i,uid:a,locale:o.Locale}),contentType:"application/json",cache:!1,error:function(e){void 0!==e&&void 0!==e.Status?alert(e.Status):void 0!==e.responseJSON&&void 0!==e.responseJSON.Status?alert(e.responseJSON.Status):alert("Error"),C()},success:function(e){var t,a,i,n;e.Error?(alert(e.Error),C()):($(".content-wrapper").css("background","none"),e=e,uniqueid=e.uniqueid,e.data.forEach(e=>{e.rows.len<50&&(e.rows.len=50)}),s=e.data,n=u+"EditorApi/ImageUrl",t=u+"EditorApi/UpdateCell",a="zh-hant"===o.Locale?"cht":o.Locale,l=x_spreadsheet("#xs-div",{updateMode:"server",updateUrl:t,mode:"edit",folderName:c,fileName:p,local:a,showCheckSyntaxButton:d,checkSyntax:!1,showFormulaExplain:d}).loadData(s).updateCellError(e=>{alert(e)}),e.showtabs||l.bottombar.hide(),t=u+"EditorApi/AddImage",a=u+"EditorApi/AddImageByUrl",i=u+"EditorApi/CopyImage",l.setUniqueId(uniqueid),l.setImageInfo(n,t,a,i,r),l.setActiveSheetByName(e.actname).setActiveCell(e.actrow,e.actcol),$.fn.scrollEnd=function(o,t){$(this).scroll(function(){var e=$(this);e.data("scrollTimeout")&&clearTimeout(e.data("scrollTimeout")),e.data("scrollTimeout",setTimeout(o,t))})},n=u+"EditorApi/Download",l.setFileDownloadInfo(n),l.setFileName(p),l.setEmailSendCallFunction&&l.setEmailSendCallFunction(S),l.setOpenFileUrl&&l.setOpenFileUrl(m),t=u+"EditorApi/Ole",l.setOleDownloadInfo(t),a=u+"EditorApi/CheckSyntax",l.setSyntaxCheckUrl(a),i=u+"EditorApi/FormulaExplain",l.setFormulaExplainUrl(i))}}),$("#confirmClose").on("click",function(){$("#confirmCloseModal").modal({keyboard:!0})}),$("#confirmCloseModal").on("show.bs.modal",function(){$("#confirmCloseModal").css("display","flex")}),(async()=>{$.getScript(o.JsPath+"/bootstrap.min."+o.JsVersionSuffix),$.getScript(o.JsPath+"/jszip.min."+o.JsVersionSuffix),$.getScript(o.JsPath+"/pako.min."+o.JsVersionSuffix),$.getScript("https://apis.google.com/js/api.js",function(){gapi.load("picker",y)}),$.getScript("https://accounts.google.com/gsi/client",function(){f=google.accounts.oauth2.initTokenClient({client_id:h,scope:n,callback:""}),g=!0})})().then())});